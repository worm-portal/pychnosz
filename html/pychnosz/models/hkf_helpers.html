<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.6">
<title>pychnosz.models.hkf_helpers API documentation</title>
<meta name="description" content="Helper functions for HKF calculations, integrated from HKF_cgl.py â€¦">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pychnosz.models.hkf_helpers</code></h1>
</header>
<section id="section-intro">
<p>Helper functions for HKF calculations, integrated from HKF_cgl.py.</p>
<p>This module contains the tested helper functions from the HKF_cgl.py notebook,
including calc_logK, calc_G_TP, G2logK, dissrxn2logK, and OBIGT2eos functions.</p>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pychnosz.models.hkf_helpers.G2logK"><code class="name flex">
<span>def <span class="ident">G2logK</span></span>(<span>G, Tc)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def G2logK(G, Tc):
    # Gas constant R is in cal/mol K
    return G / (-math.log(10) * 1.9872 * (273.15+Tc))</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="pychnosz.models.hkf_helpers.OBIGT2eos"><code class="name flex">
<span>def <span class="ident">OBIGT2eos</span></span>(<span>OBIGT, fixGHS=True, tocal=True, messages=True)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def OBIGT2eos(OBIGT, fixGHS=True, tocal=True, messages=True):
    &#34;&#34;&#34;
    Convert OBIGT dataframe to equation of state parameters.

    This function processes the OBIGT thermodynamic database to prepare it for
    equation of state calculations. It handles energy unit conversions and
    optionally fills in missing G, H, or S values.

    Parameters
    ----------
    OBIGT : pd.DataFrame
        OBIGT thermodynamic database
    fixGHS : bool, default True
        Fill in one missing value among G, H, S using thermodynamic relations
    tocal : bool, default True
        Convert energy units from Joules to calories
    messages : bool, default True
        Print informational messages (currently not used, reserved for future)

    Returns
    -------
    pd.DataFrame
        Modified OBIGT dataframe with converted parameters
    &#34;&#34;&#34;
    OBIGT_out = OBIGT.copy()

    # Get column indices for named columns (to handle varying column positions)
    G_idx = OBIGT.columns.get_loc(&#39;G&#39;)
    H_idx = OBIGT.columns.get_loc(&#39;H&#39;)
    S_idx = OBIGT.columns.get_loc(&#39;S&#39;)
    Cp_idx = OBIGT.columns.get_loc(&#39;Cp&#39;)
    V_idx = OBIGT.columns.get_loc(&#39;V&#39;)
    omega_lambda_idx = OBIGT.columns.get_loc(&#39;omega.lambda&#39;)

    for i in range(0, OBIGT.shape[0]):

        # we only convert omega for aqueous species, not lambda for cgl species
        if tocal and OBIGT.iloc[i, :][&#34;E_units&#34;] == &#34;J&#34; and OBIGT.iloc[i, :][&#34;state&#34;] == &#34;aq&#34;:
            # Convert G, H, S, Cp
            OBIGT_out.iloc[i, G_idx:Cp_idx+1] = OBIGT.iloc[i, G_idx:Cp_idx+1]/4.184
            # Convert V through omega (includes omega for aq species)
            OBIGT_out.iloc[i, V_idx:omega_lambda_idx+1] = OBIGT.iloc[i, V_idx:omega_lambda_idx+1]/4.184
            OBIGT_out.iloc[i, OBIGT.columns.get_loc(&#39;E_units&#39;)] = &#34;cal&#34;

        elif tocal and OBIGT.iloc[i, :][&#34;E_units&#34;] == &#34;J&#34;:
            # Convert G, H, S, Cp
            OBIGT_out.iloc[i, G_idx:Cp_idx+1] = OBIGT.iloc[i, G_idx:Cp_idx+1]/4.184
            # Convert V through c2.f (exclude omega.lambda for non-aq species)
            OBIGT_out.iloc[i, V_idx:omega_lambda_idx] = OBIGT.iloc[i, V_idx:omega_lambda_idx]/4.184
            OBIGT_out.iloc[i, OBIGT.columns.get_loc(&#39;E_units&#39;)] = &#34;cal&#34;

        # fill in one of missing G, H, S
        # for use esp. by subcrt because NA for one of G, H or S
        # will preclude calculations at high T
        if fixGHS:
            # which entries are missing just one
            GHS_values = [OBIGT.iloc[i, G_idx], OBIGT.iloc[i, H_idx], OBIGT.iloc[i, S_idx]]
            imiss = [pd.isna(v) for v in GHS_values]
            if sum(imiss) == 1:

                ii = imiss.index(True)

                if ii == 0:  # G is missing
                    H = OBIGT_out.iloc[i, H_idx]
                    S = OBIGT_out.iloc[i, S_idx]
                    Selem = entropy(OBIGT_out.iloc[i, OBIGT_out.columns.get_loc(&#39;formula&#39;)])
                    T = 298.15
                    G = H - T*(S - Selem)
                    OBIGT_out.iloc[i, G_idx] = G
                elif ii == 1:  # H is missing
                    G = OBIGT_out.iloc[i, G_idx]
                    S = OBIGT_out.iloc[i, S_idx]
                    Selem = entropy(OBIGT_out.iloc[i, OBIGT_out.columns.get_loc(&#39;formula&#39;)])
                    T = 298.15
                    H = G + T*(S - Selem)
                    OBIGT_out.iloc[i, H_idx] = H
                elif ii == 2:  # S is missing
                    G = OBIGT_out.iloc[i, G_idx]
                    H = OBIGT_out.iloc[i, H_idx]
                    Selem = entropy(OBIGT_out.iloc[i, OBIGT_out.columns.get_loc(&#39;formula&#39;)])
                    T = 298.15
                    S = Selem + (H - G)/T
                    OBIGT_out.iloc[i, S_idx] = S

    return OBIGT_out</code></pre>
</details>
<div class="desc"><p>Convert OBIGT dataframe to equation of state parameters.</p>
<p>This function processes the OBIGT thermodynamic database to prepare it for
equation of state calculations. It handles energy unit conversions and
optionally fills in missing G, H, or S values.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>OBIGT</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>OBIGT thermodynamic database</dd>
<dt><strong><code>fixGHS</code></strong> :&ensp;<code>bool</code>, default <code>True</code></dt>
<dd>Fill in one missing value among G, H, S using thermodynamic relations</dd>
<dt><strong><code>tocal</code></strong> :&ensp;<code>bool</code>, default <code>True</code></dt>
<dd>Convert energy units from Joules to calories</dd>
<dt><strong><code>messages</code></strong> :&ensp;<code>bool</code>, default <code>True</code></dt>
<dd>Print informational messages (currently not used, reserved for future)</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>pd.DataFrame</code></dt>
<dd>Modified OBIGT dataframe with converted parameters</dd>
</dl></div>
</dd>
<dt id="pychnosz.models.hkf_helpers.calc_G_TP"><code class="name flex">
<span>def <span class="ident">calc_G_TP</span></span>(<span>OBIGT, Tc, P, water_model)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calc_G_TP(OBIGT, Tc, P, water_model):
    
    aq_out, H2O_Pt = hkf(property=[&#34;G&#34;], parameters=OBIGT,
                         T=273.15+Tc, P=P, contrib=[&#34;n&#34;, &#34;s&#34;, &#34;o&#34;],
                         H2O_props=[&#34;rho&#34;], water_model=water_model)
    
    cgl_out = cgl(property=[&#34;G&#34;], parameters=OBIGT, T=273.15+Tc, P=P)
    
    aq_col = pd.DataFrame.from_dict(aq_out, orient=&#34;index&#34;)
    cgl_col = pd.DataFrame.from_dict(cgl_out, orient=&#34;index&#34;)

    G_TP_df = pd.concat([aq_col, cgl_col], axis=1)
    G_TP_df.columns = [&#39;aq&#39;,&#39;cgl&#39;]
    
    OBIGT[&#34;G_TP&#34;] = G_TP_df[&#39;aq&#39;].combine_first(G_TP_df[&#39;cgl&#39;])
    
    rows_added = 0

    # add a row for water
    if &#34;H2O&#34; not in list(OBIGT[&#34;name&#34;]):
        # Set the water model (without printing messages)
        water(water_model, messages=False)
        # water() returns a scalar when called with single property and scalar T, P
        # The result is in J/mol, need to convert to cal/mol by dividing by 4.184
        G_water = water(&#34;G&#34;, T=Tc+273.15, P=P, messages=False)
        # Handle both scalar and DataFrame returns
        if isinstance(G_water, pd.DataFrame):
            G_water_cal = G_water.iloc[0][&#34;G&#34;] / 4.184
        else:
            G_water_cal = float(G_water) / 4.184
        OBIGT = pd.concat([OBIGT, pd.DataFrame({&#34;name&#34;: &#34;H2O&#34;, &#34;tag&#34;: &#34;nan&#34;, &#34;G_TP&#34;: G_water_cal}, index=[OBIGT.shape[0]])], ignore_index=True)
        rows_added += 1

    # add a row for protons
    if &#34;H+&#34; not in list(OBIGT[&#34;name&#34;]):
        OBIGT = pd.concat([OBIGT, pd.DataFrame({&#34;name&#34;: &#34;H+&#34;, &#34;tag&#34;: &#34;nan&#34;, &#34;G_TP&#34;: 0}, index=[OBIGT.shape[0]])], ignore_index=True)
        rows_added += 1

    return OBIGT, rows_added</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="pychnosz.models.hkf_helpers.calc_logK"><code class="name flex">
<span>def <span class="ident">calc_logK</span></span>(<span>OBIGT_df, Tc, P, TP_i, water_model)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def calc_logK(OBIGT_df, Tc, P, TP_i, water_model):
    
    OBIGT_TP, rows_added = calc_G_TP(OBIGT_df, Tc, P, water_model)
    
    dissrxn2logK_out = []
    for i in OBIGT_TP.index:
        dissrxn2logK_out.append(dissrxn2logK(OBIGT_TP, i, Tc))
    assert len(dissrxn2logK_out) == OBIGT_TP.shape[0]
    
    OBIGT_TP[&#39;dissrxn_logK_&#39;+str(TP_i)] = dissrxn2logK_out
    
    # remove any rows added by calc_G_TP
    OBIGT_TP.drop(OBIGT_TP.tail(rows_added).index, inplace = True)
    
    return OBIGT_TP</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="pychnosz.models.hkf_helpers.convert_cm3bar"><code class="name flex">
<span>def <span class="ident">convert_cm3bar</span></span>(<span>value)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def convert_cm3bar(value):
    return value*4.184 * 10</code></pre>
</details>
<div class="desc"></div>
</dd>
<dt id="pychnosz.models.hkf_helpers.dissrxn2logK"><code class="name flex">
<span>def <span class="ident">dissrxn2logK</span></span>(<span>OBIGT, i, Tc)</span>
</code></dt>
<dd>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dissrxn2logK(OBIGT, i, Tc):
    
    this_dissrxn = OBIGT.iloc[i, OBIGT.columns.get_loc(&#39;dissrxn&#39;)]
    
    if this_dissrxn == &#34;nan&#34;:
        this_dissrxn = OBIGT.iloc[i, OBIGT.columns.get_loc(&#39;regenerate_dissrxn&#39;)]
    
#     print(OBIGT[&#34;name&#34;][i], this_dissrxn)
    
    try:
        this_dissrxn = this_dissrxn.strip()
        split_dissrxn = this_dissrxn.split(&#34; &#34;)
    except:
        return float(&#39;NaN&#39;)
    
    
    
    coeff = [float(n) for n in split_dissrxn[::2]]
    species = split_dissrxn[1::2]
    try:
        G = sum([float(c*OBIGT.loc[OBIGT[&#34;name&#34;]==sp, &#34;G_TP&#34;].iloc[0]) for c,sp in zip(coeff, species)])
    except:
        G_list = []
        for ii, sp in enumerate(species):
            G_TP = OBIGT.loc[OBIGT[&#34;name&#34;]==sp, &#34;G_TP&#34;]
            if len(G_TP) == 1:
                G_list.append(float(coeff[ii]*OBIGT.loc[OBIGT[&#34;name&#34;]==sp, &#34;G_TP&#34;]))
            else:
                ### check valid polymorph T

                # get polymorph entries of OBIGT that match mineral
                poly_df = copy.copy(OBIGT.loc[OBIGT[&#34;name&#34;]==sp,:])
                # ensure polymorph df is sorted according to cr, cr2, cr3... etc.
                poly_df = poly_df.sort_values(&#34;state&#34;)

                z_Ts = list(poly_df.loc[poly_df[&#34;name&#34;]==sp, &#34;z.T&#34;])

                last_t = float(&#39;-inf&#39;)
                appended=False
                for iii,t in enumerate(z_Ts):

                    if Tc+273.15 &gt; last_t and Tc+273.15 &lt; t:
                        G_list.append(float(coeff[ii]*list(poly_df.loc[poly_df[&#34;name&#34;]==sp, &#34;G_TP&#34;])[iii]))
                        appended=True
                    if not appended and z_Ts[-1] == t:
                        G_list.append(float(coeff[ii]*list(poly_df.loc[poly_df[&#34;name&#34;]==sp, &#34;G_TP&#34;])[iii]))
                    last_t = t

        G = sum(G_list)

    return G2logK(G, Tc)</code></pre>
</details>
<div class="desc"></div>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pychnosz.models" href="index.html">pychnosz.models</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="pychnosz.models.hkf_helpers.G2logK" href="#pychnosz.models.hkf_helpers.G2logK">G2logK</a></code></li>
<li><code><a title="pychnosz.models.hkf_helpers.OBIGT2eos" href="#pychnosz.models.hkf_helpers.OBIGT2eos">OBIGT2eos</a></code></li>
<li><code><a title="pychnosz.models.hkf_helpers.calc_G_TP" href="#pychnosz.models.hkf_helpers.calc_G_TP">calc_G_TP</a></code></li>
<li><code><a title="pychnosz.models.hkf_helpers.calc_logK" href="#pychnosz.models.hkf_helpers.calc_logK">calc_logK</a></code></li>
<li><code><a title="pychnosz.models.hkf_helpers.convert_cm3bar" href="#pychnosz.models.hkf_helpers.convert_cm3bar">convert_cm3bar</a></code></li>
<li><code><a title="pychnosz.models.hkf_helpers.dissrxn2logK" href="#pychnosz.models.hkf_helpers.dissrxn2logK">dissrxn2logK</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.6</a>.</p>
</footer>
</body>
</html>
